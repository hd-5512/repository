## 一、线程/进程？
进程是具有一定独立功能的，在计算机中已经运行的程序的实体。

在早期系统中(linux2.4以前)，进程是基本运作单位。

在支持线程的系统中(如windows，linux2.6)中，<font color=#FF0000>线程才是基本的运作单位，而进程只是线程的容器。</font>

程序本身只是指令、数据及其组织形式的描述，有句话说『数据结构+算法=程序』
进程才是程序（那些指令和数据）的真正运行实例。
若干进程有可能与同一个程序相关系，且每个进程皆可以同步（循序）或异步（平行）的方式独立运行。
现代计算机系统可在同一段时间内以进程的形式将多个程序加载到存储器中，并借由时间共享（或称时分复用），以在一个处理器上表现出同时（平行性）运行的感觉。
同样的，使用多线程技术（多线程即每一个线程都代表一个进程内的一个独立执行上下文）的操作系统或计算机架构，同样程序的平行线程，可在多CPU主机或网络上真正同时运行（在不同的CPU上）。



## 二、常见Web服务方式
#### 2.1 三种工作模型比较：
Web服务器要为用户提供服务，必须以某种方式，工作在某个套接字上。
一般Web服务器在处理用户请求有如下三种方式可选择：多进程方式、多线程方式、异步方式。

多进程方式：为每个请求启动一个进程来处理。由于在操作系统中，生成进程、销毁进程、进程间切换都很消耗CPU和内存，当负载高是，性能会明显降低。
优点： 稳定性！由于采用独立进程处理独立请求，而进程之间是独立的，单个进程问题不会影响其他进程，因此稳定性最好。

缺点： 资源占用！当请求过大时，需要大量的进程处理请求，进程生成、切换开销很大，而且进程间资源是独立的，造成内存重复利用。

多线程方式：一个进程中用多个线程处理用户请求。由于线程开销明显小于进程，而且部分资源还可以共享，因此效率较高。
优点：开销较小！线程间部分数据是共享的，且线程生成与线程间的切换所需资源开销比进程间切换小得多。

缺点：稳定性！线程切换过快可能造成线程抖动，且线程过多会造成服务器不稳定。

异步方式：使用非阻塞方式处理请求，是三种方式中开销最小的。但异步方式虽然效率高，但要求也高，因为多任务之间的调度如果出现问题，就可能出现整体故障，因此使用异步工作的，一般是一些功能相对简单，但却符合服务器任务调度、且代码中没有影响调度的错误代码存在的程序。
优点：性能最好！一个进程或线程处理多个请求，不需要额外开销，性能最好，资源占用最低。

缺点：稳定性！某个进程或线程出错，可能导致大量请求无法处理，甚至导致整个服务宕机。

#### 2.2 一个Web请求的处理过程

![Image text](./uml/一个Web请求的处理过程.puml)

1. 客户发起情况到服务器网卡
2. 服务器网卡接受到请求后转交给内核处理；
3. 内核根据请求对应的套接字，将请求交给工作在用户空间的Web服务器进程
4. Web服务器进程根据用户请求，向内核进行系统调用，申请获取相应资源（如index.html）
5. 内核发现web服务器进程请求的是一个存放在硬盘上的资源，因此通过驱动程序连接磁盘
6. 内核调度磁盘，获取需要的资源
7. 内核将资源存放在自己的缓冲区中，并通知Web服务器进程
8. Web服务器进程通过系统调用取得资源，并将其复制到进程自己的缓冲区中
9. Web服务器进程形成响应，通过系统调用再次发给内核以响应用户请求
10. 内核将响应发送至网卡
11. 网卡发送响应给用户

